# UPI Payment Issue - Root Cause & Fix

## Problem Statement
- ✅ **QR Code Payment**: Works successfully
- ❌ **Button Payment**: Fails with "Payment was declined by your bank or your receiver's bank"

## Root Causes Identified

### 1. **Payee Name Encoding Issue**
- **Original**: `pn=Manav%20Seva%20Charitable%20Trust` (URL-encoded with spaces)
- **Issue**: Some UPI apps and banks reject payee names with URL-encoded spaces
- **Fix**: Use `pn=ManavSevaCharitableTrust` (no spaces, single word)

### 2. **Missing Transaction Reference (tr)**
- **Original**: No `tr` parameter
- **Issue**: Banks use transaction reference for validation and fraud detection
- **Fix**: Added `tr=MSCT001` for transaction tracking

### 3. **Transaction Note Too Long**
- **Original**: `tn=Donation%20to%20Manav%20Seva%20Charitable%20Trust` (long)
- **Issue**: Some banks have character limits on transaction notes
- **Fix**: Shortened to `tn=Donation` (simple, clear)

### 4. **Amount Format**
- **Correct**: `am=1.00` (decimal format with 2 decimal places)
- **Status**: Already correct in previous fix

## Updated UPI Link

```
upi://pay?pa=manavseva2025@sbi&pn=ManavSevaCharitableTrust&am=1.00&cu=INR&tn=Donation&tr=MSCT001
```

### Parameter Breakdown
| Parameter | Value | Purpose |
|-----------|-------|---------|
| `pa` | manavseva2025@sbi | Payee VPA (UPI ID) |
| `pn` | ManavSevaCharitableTrust | Payee Name (no spaces) |
| `am` | 1.00 | Amount in decimal format |
| `cu` | INR | Currency code |
| `tn` | Donation | Transaction note (short) |
| `tr` | MSCT001 | Transaction reference ID |

## Why QR Code Works But Button Doesn't

1. **QR Code**: Generated by UPI provider with validated parameters
2. **Button**: Manual URL construction prone to encoding/validation issues
3. **Bank Validation**: Stricter when parameters are manually provided

## Testing Checklist

- [ ] Test on Android with Google Pay
- [ ] Test on Android with PhonePe
- [ ] Test on Android with BHIM
- [ ] Test on iOS with supported UPI apps
- [ ] Verify payment completes without decline
- [ ] Check transaction appears in bank account

## Additional Recommendations

1. **Add Merchant Category Code (MCC)** if available from your bank
2. **Use consistent transaction reference** format (e.g., MSCT + timestamp)
3. **Monitor payment failures** and adjust parameters if needed
4. **Consider Razorpay/Stripe integration** for production use

## File Modified
- `src/components/RupeeRevolutionSection.tsx` (Line 116)

